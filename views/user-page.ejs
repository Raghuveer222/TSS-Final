<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="/stylesheets/user-page.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body style="background-color: lightblue;">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: grey;">
        <div class="container-fluid">
            <a class="navbar-brand text-light" href="#">Transport Scheduler</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav" >
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="#" data-section="dashboard-section">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="initiate-shipment-section">Initiate Shipment</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="manage-profile-section">Manage Profile</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="contact-section">Contact</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="help-section">Help</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#feedbackModal">Feedback</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="notifications-section">Notifications</a></li>
                </ul>
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container my-4">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="section active">
            <h2>Welcome to Transport Scheduler,<%= loggedInUser.name %></h2>
            <p>Transport Scheduler is your one-stop solution for scheduling and managing shipments efficiently. 
               Whether you're an individual or a business, our platform ensures that your logistics needs are met seamlessly. 
               Track your deliveries, initiate shipments, and manage your profile with ease.</p>

            <!-- Carousel -->
            <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="0" class="active" aria-current="true"></button>
                    <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="1"></button>
                    <button type="button" data-bs-target="#carouselExample" data-bs-slide-to="2"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="/image/project.1.JPG" class="d-block w-100" alt="Project Image 1">
                        <div class="carousel-caption">
                            <h5>Book, track, and travel with ease</h5>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="/image/photo8.JPG" class="d-block w-100" alt="Project Image 2">
                        <div class="carousel-caption">
                            <h5>Fast and easy transportation services for everyone</h5>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <img src="/image/photo_3.JPG" class="d-block w-100" alt="Project Image 3">
                        <div class="carousel-caption">
                            <h5>Connect with reliable transporters for your needs</h5>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>

            <!-- Features Section -->
            <h5>Why Choose Us?</h5>
            <ul>
                <li>Easy-to-use shipment scheduling and management.</li>
                <li>Wide range of vehicles for diverse transport needs.</li>
                <li>Real-time updates and notifications.</li>
                <li>Secure and reliable delivery solutions.</li>
            </ul>

            <h5>How It Works?</h5>
            <ul>
                <li>Create your account and log in.</li>
                <li>Initiate your shipment by entering details like location, date, and vehicle type.</li>
                <li>Relax while we handle the rest.</li>
            </ul>
        </section>

        <!-- Initiate Shipment Section -->
<section id="initiate-shipment-section" class="section">
    <h1>Initiate Shipment</h1>
    <form id="shipmentForm" action="/shipment" method="post">
        <div class="mb-3">
            <label for="location" class="form-label">Drop-off Location:</label>
            <input type="text" id="location" name="location" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="dateTime" class="form-label">Select Date and Time:</label>
            <input type="datetime-local" id="dateTime" name="dateTime" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="goodsDescription" class="form-label">Describe Goods:</label>
            <textarea id="goodsDescription" name="goodsDescription" class="form-control" required></textarea>
        </div>
        <div class="mb-3">
            <label for="vehicleType" class="form-label">Choose Vehicle Type:</label>
            <select id="vehicleType" name="vehicleType" class="form-select" required>
                <option value="Truck">Truck</option>
                <option value="Van">Van</option>
                <option value="Bike">Bike</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Submit Delivery Request</button>
    </form>
</section>



      <!-- Manage Profile Section -->
      <!-- Manage Profile Section -->
<!-- Manage Profile Section -->
<div id="manage-profile-section" class="section">
    <h1>Manage Profile</h1>
    
    <!-- Display current username and email -->
    <form action="/update-profile_2" method="POST">
        <div>
            <label for="username">Username</label>
            <input type="text" id="username" name="name" value="<%= loggedInUser.name %>" required />
        </div>
        <div>
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="<%= loggedInUser.email %>" required />
        </div>
        <div>
            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Leave blank to keep current password" />
        </div>
        <button type="submit">Update Profile</button>
    </form>
</div>


        <div class="container mt-4">
            <!-- Contact Section -->
            <div id="contact-section" class="section">
                <h2>Contact Us</h2>
                <p>Have questions or need support? Reach out to us through the form below:</p>
                <form id="contactForm">
                    <div class="mb-3">
                        <label for="contactName" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="contactName" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactEmail" class="form-label">Your Email</label>
                        <input type="email" class="form-control" id="contactEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="mb-3">
                        <label for="contactMessage" class="form-label">Your Message</label>
                        <textarea class="form-control" id="contactMessage" rows="4" placeholder="Enter your message" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Send Message</button>
                </form>
            </div>
        
            <!-- Help Section -->
            <div id="help-section" class="section">
                <h2>Help Center</h2>
                <p>Find answers to common questions below or contact us for more support:</p>
                <ul>
                    <li><strong>How do I create a shipment?</strong>
                        <p>Go to the "Initiate Shipment" section and fill out the required details. Submit the form to create a new shipment request.</p>
                    </li>
                    <li><strong>How can I track my shipments?</strong>
                        <p>Tracking features will be added soon! Stay tuned for updates.</p>
                    </li>
                    <li><strong>How do I update my profile?</strong>
                        <p>Go to the "Manage Profile" section to edit your personal information.</p>
                    </li>
                </ul>
            </div>
        </div>




        <!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="feedbackModalLabel">Submit Your Feedback</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="feedbackForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="feedbackInput" class="form-label">Your Feedback</label>
                        <textarea class="form-control" id="feedbackInput" rows="4" placeholder="Enter your feedback" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Submit Feedback</button>
                </div>
            </form>
        </div>
    </div>
</div>



<!-- notification -->
 <!-- In userDashboard.ejs -->
<!-- <h2>Your Notifications:</h2>
<div id="notifications-container">
    <% if (loggedInUser.notifications && loggedInUser.notifications.length > 0) { %>
        <ul>
            <% loggedInUser.notifications.forEach(notification => { %>
                <li>
                    <strong><%= notification.date.toLocaleString() %></strong><br>
                    <%= notification.message %>
                </li>
            <% }); %>
        </ul>
    <% } else { %>
        <p>You have no new notifications.</p>
    <% } %>
</div> -->



        

        <!-- Footer -->
        <footer class="text-center mt-4">
            <p>&copy; 2024 Transport Scheduler. All Rights Reserved.</p>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Retrieve logged-in user details from localStorage
        const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
    
        // Redirect to login if no user is logged in
        if (!loggedInUser) {
            alert("No user is logged in. Redirecting to login page.");
            window.location.href = "login.html"; // Update the redirect URL
        } else {
            // Populate user profile
            document.getElementById("username").textContent = loggedInUser.name;
            document.getElementById("email").textContent = loggedInUser.email;
        }
    
        // Dashboard Navigation
        document.querySelectorAll(".nav-link").forEach(link => {
            link.addEventListener("click", (e) => {
                const targetSection = e.target.getAttribute("data-section");
                showSection(targetSection);
            });
        });
    
        function showSection(sectionId) {
            document.querySelectorAll(".section").forEach(section => section.classList.remove("active"));
            document.getElementById(sectionId).classList.add("active");
        }
    
        // Handle feedback form submission
        document.getElementById("feedbackForm").addEventListener("submit", function (e) {
            e.preventDefault();
    
            const feedback = document.getElementById("feedbackInput").value.trim();
            if (!feedback) {
                alert("Please enter some feedback!");
                return;
            }
    
            const feedbacks = JSON.parse(localStorage.getItem("feedbacks")) || [];
            feedbacks.push({
                feedback,
                user: loggedInUser.email,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem("feedbacks", JSON.stringify(feedbacks));
    
            alert("Thank you for your feedback!");
            document.getElementById("feedbackForm").reset();
    
            // Hide feedback modal using Bootstrap Modal API
            const feedbackModal = document.getElementById("feedbackModal");
            const modalInstance = bootstrap.Modal.getInstance(feedbackModal);
            modalInstance.hide();
        });
    
        // Logout functionality
        document.getElementById("logout-btn").addEventListener("click", function () {
            localStorage.removeItem("loggedInUser");
            alert("You have been logged out successfully.");
            window.location.href = "/";
        });
    
        // Dynamic date in footer
        document.getElementById("current-year").textContent = new Date().getFullYear();
    
        // Page load event
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Page fully loaded!");
        });
    
        // Tooltip initialization using Bootstrap
        [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).forEach(tooltipTriggerEl => {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });



        // ---
// Fetch and display notifications dynamically on page load
window.onload = async function() {
    try {
        const response = await fetch('/user/notifications');
        const data = await response.json();
        
        if (data.success) {
            const notificationsContainer = document.getElementById('notifications-container');
            notificationsContainer.innerHTML = ''; // Clear any existing notifications
            
            if (data.notifications.length > 0) {
                data.notifications.forEach(notification => {
                    const notificationElement = document.createElement('li');
                    notificationElement.innerHTML = `<strong>${new Date(notification.date).toLocaleString()}</strong><br>${notification.message}`;
                    notificationsContainer.appendChild(notificationElement);
                });
            } else {
                notificationsContainer.innerHTML = '<p>You have no new notifications.</p>';
            }
        }
    } catch (error) {
        console.error('Error fetching notifications:', error);
    }
};



document.getElementById('shipmentForm').addEventListener('submit', (event) => {
    event.preventDefault(); // Prevent default form submission
    fetch('/shipment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            location: document.getElementById('location').value,
            dateTime: document.getElementById('dateTime').value,
            goodsDescription: document.getElementById('goodsDescription').value,
            vehicleType: document.getElementById('vehicleType').value,
        }),
    }).then((response) => {
        if (response.ok) {
            window.location.href = '/user-dashboard';
        } else {
            alert('Error submitting shipment.');
        }
    });
});

    </script>
    
    
</body>
</html>
